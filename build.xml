<project name="Template" default="CompileAndTests" basedir=".">  <description>Federagenti</description>  <property environment="env"/>  <tstamp prefix="datetime"/>  <!-- setup XE3 compiler -->  <property name="prjname" value="Template"/>  <property name="prjversion" value="1.0"/>  <property name="prjversiontag" value="1_0"/>  <property name="tagurl" value="https://192.168.5.185/svn/delphi/tags/${prjname}_${prjversiontag}_${env.BUILD_NUMBER}"/>  <property name="BDS" value="C:\Program Files (x86)\Embarcadero\Studio\17.0"/>  <property name="BDSINCLUDE" value="C:\Program Files (x86)\Embarcadero\Studio\17.0\include"/>  <property name="BDSCOMMONDIR" value="C:\Users\Public\Documents\Studio\17.0"/>  <property name="FrameworkDir" value="C:\Windows\Microsoft.NET\Framework\v3.5"/>  <property name="PLATFORMENV" value=""/>  <property name="FrameworkVersion" value="v3.5"/>  <property name="PATHENV" value="PATH=%FrameworkDir%;%FrameworkSDKDir%;C:\Program Files (x86)\Embarcadero\Studio\17.0\bin;C:\Program Files (x86)\Embarcadero\Studio\17.0\bin64;C:\Users\Public\Documents\Embarcadero\InterBase\redist\InterBaseXE3\win32_togo;C:\Users\Public\Documents\Embarcadero\InterBase\redist\InterBaseXE3\win64_togo;%PATH%"/>  <property name="tagmessage" value="jenkins auto tagging"/>      <macrodef name="dcc">    <attribute name="BuildConfig" default="Test" />    <attribute name="Platform" default="Win32" />    <attribute name="Target" default="Build" />    <attribute name="ProjectFile" />    <attribute name="BDS" default="${BDS}"  />    <sequential>      <echo>  _____ _______       _____ _______  / ____|__   __|/\   |  __ \__   __|| (___    | |  /  \  | |__) | | |    \___ \   | | / /\ \ |  _  /  | |    ____) |  | |/ ____ \| | \ \  | |   |_____/   |_/_/    \_\_|  \_\ |_|   ====================================Project:  @{ProjectFile}Config:   @{BuildConfig}Platform: @{Platform}Target:   @{Target}BDS:      @{BDS}====================================      </echo>      <exec failonerror="true" searchpath="true" executable="${FrameworkDir}\msbuild.exe">        <env key="BDS" value="${BDS}"/>        <env key="BDSINCLUDE" value="${BDSINCLUDE}"/>        <env key="BDSCOMMONDIR" value="${BDSCOMMONDIR}"/>        <env key="PLATFORM" value="${PLATFORMENV}"/>        <env key="PATH" value="${PATHENV}"/>                <arg value="/nologo"/>        <arg value="/target:@{Target}"/>        <arg value="/property:config=@{BuildConfig};platform=@{Platform}"/>        <arg value="/verbosity:detailed"/>        <arg value="@{ProjectFile}"/>      </exec>    </sequential>  </macrodef>    <macrodef name="svn_tag">    <attribute name="trunkurl" default="define a url" />    <attribute name="tagfolders" default="" />    <sequential>      <echo>  _____ ___________      __   __|/\   |  __ \  | |  /  \  | |  )_|     | | / /\ \ | | ___    | |/ ____ \| |__| |  |_/_/    \_\______|   ====================================From Trunk:  @{trunk}To TAg:   @{tag}    ====================================           </echo>          <exec failonerror="true" searchpath="true" executable="svn.exe">            <arg value="copy"/>            <arg value="@{trunkurl}"/>            <arg value="${tagurl}@{tagfolders}"/>            <arg value="-m ${tagmessage}"/>                    <arg value="--parents"/>                  </exec>    </sequential>  </macrodef>    <macrodef name="testrun">    <attribute name="executable" />    <attribute name="from" default=".\" />    <element name="before" optional="yes"/>    <element name="after" optional="yes"/>    <sequential>      <before />      <exec dir="@{from}" executable="@{executable}" resultproperty="testrun-result" vmlauncher="false" failonerror="true" />      <after       />      <!-- inserito la fail condition qui in modo da eseguire sempre l'after anche in caso di tests fail -->      <fail>        <condition>          <isfailure code="${testrun-result}" />        </condition>      </fail>      <echo>${testrun-result} </echo>    </sequential>                                        </macrodef>      <extension-point name="CompileAndTests" depends="compile,tests,BuildSetupsOnly" />  <extension-point name="BuildSetupsOnly" depends="compile_setup,build_setup_server_service,build_setup_client" />  <extension-point name="DeployProject" depends="CompileAndTests,tag_project" />      <extension-point name="compile" depends="set-version,compile_ServerTests,compile_ClientTests,compile_server,compile_client" />   <extension-point name="compile_setup" depends="set-version,compile_server" />  <extension-point name="tests" depends="redist,run_server_tests,run_client_tests" />  <extension-point name="tag_project" depends="svn_tag_project,svn_tag_Artifacts" />    <target name="set-version">    <replace file="..\libs\ServerTemplate\Server\server.version.pas" token="#DATETIME#" value="${prjversion}.${env.BUILD_NUMBER}"/>    <replace file=".\Scripts\SetupServer.iss" token="#VERSION#" value="${prjversion}.${env.BUILD_NUMBER}"/>    <replace file=".\Scripts\SetupClient.iss" token="#VERSION#" value="${prjversion}.${env.BUILD_NUMBER}"/>    <replace file=".\index.html" token="#VERSION#" value="${prjversion}.${env.BUILD_NUMBER}"/>  </target>                                 <target name="compile_ClientTests">    <dcc BuildConfig="release" Platform="Win32" ProjectFile=".\Tests\Client\ClientTests.dproj" />  </target>  <target name="compile_ServerTests">    <dcc BuildConfig="release" Platform="Win32" ProjectFile=".\Tests\Server\ServerTests.dproj" />  </target>  <target name="compile_client">    <dcc BuildConfig="release" Platform="Win64" ProjectFile=".\Client\Mobile\${prjname}Client.dproj" />    <dcc BuildConfig="release" Platform="Win32" ProjectFile=".\Client\Mobile\${prjname}Client.dproj" />    <dcc BuildConfig="release" Platform="Android" ProjectFile=".\Client\Mobile\${prjname}Client.dproj" />  </target>  <target name="compile_server">    <dcc BuildConfig="release" Platform="Win32" ProjectFile=".\Server\${prjname}Server.dproj" />    <dcc BuildConfig="release" Platform="Win32" ProjectFile=".\Server\${prjname}ServerService.dproj" />  </target>   <target name="redist">                                            <testrun executable="redist.bat" from=".\" />  </target>     <target name="run_server_tests">                                            <testrun executable="ServerTests.exe" from=".\Tests\Server\Win32\Release\" />  </target>     <target name="run_client_tests">                                            <testrun executable="ClientTests.exe" from=".\Tests\Client\Win32\Release\" />  </target>      <target name="build_setup_server_service" >    <exec dir=".\Scripts" failonerror="true" searchpath="true" executable="C:\Program Files (x86)\Inno Setup 5\Compil32.exe" >      <arg value="/cc"/>      <arg value="SetupServer.iss"/>    </exec>  </target>   <target name="build_setup_client" >    <exec dir=".\Scripts" failonerror="true" searchpath="true" executable="C:\Program Files (x86)\Inno Setup 5\Compil32.exe" >      <arg value="/cc"/>      <arg value="SetupClient.iss"/>    </exec>  </target>   <target name="svn_tag_Artifacts"  >    <exec dir="." failonerror="true" searchpath="true" executable="svn.exe" >      <arg value="import"/>      <arg value="Setup"/>      <arg value="${tagurl}/${prjname}/Setup"/>      <arg value="-m ${tagmessage}"/>    </exec>  </target>       <target name="svn_tag_project">       <svn_tag trunkurl="https://192.168.5.185/svn/delphi/trunk/${prjname}"  tagfolders="/${prjname}"  />      <svn_tag trunkurl="https://192.168.5.185/svn/delphi/trunk/libs"  tagfolders="/libs"  />             </target> </project>